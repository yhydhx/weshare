{% extends "frontEnd/base.html" %}<!-- 继承基础模板 -->
{% load staticfiles %}<!-- 加载全局变量 --> 

{% block body %}



<style>
    body{
        background-color:white; 
    }
</style>

    <div class="container" style="margin-top: 60px;">
    	<div class="row">
    		{% include "frontEnd/center-left.html" %}<!-- 加载左侧栏 -->
    		<div class="col-md-10" >


                {% if current_user.state == 1 %}
                <div class="row" style="padding-top: 10px; ">
                    <a href="" class="ct-login"><span>审核中</span><i class="fa fa-lock"></i></a>
                </div>
                {% endif %}

                <form class=" ct-u-marginBottom input-daterange input-group" action="/host_center/modify_host_info" method="post" id="form1">
                {% csrf_token %}

                    <!-- 修改主页资料 -->
                    <div class="row" style="display: flex;align-items: center; padding-top:60px; ">
                        <div class="col-xs-4"><hr></div>
                        <div class="col-xs-4" style="text-align:center;">
                            <h4>主页资料修改</h4>
                        </div>
                        <div class="col-xs-4"><hr></div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 col-md-offset-3 ct-u-paddingTop80">

                            <div class="ct-panel-inner">

                                <div class="form-group ">
                                    <label for="motto">一句话简介</label>
                                    <input id="motto" name="motto" type="text"
                                           value="{{ current_user.motto }}"
                                           class="form-control form-control--type2">
                                </div>

                                <div class="form-group">
                                    <label for="service-time" class="required">您方便服务的时间</label>
                                    <input id="service-time" name="service-time" required
                                           value="{{ current_user.service_time }}"
                                           class="form-control form-control--type2">
                                </div>

                                <div class="form-group">
                                    <label for="min-payment" class="required">最低薪酬(人民币元/小时)</label>
                                    <input id="min-payment" name="min-payment" type="number" required 
                                            value="{{ current_user.min_payment }}"
                                           class="form-control form-control--type2">
                                </div>

                                <div class="form-group">
                                    <label for="max-payment" class="required">最高薪酬(人民币元/小时)</label>
                                    <input id="max-payment" name="max-payment" type="number" required 
                                            value="{{ current_user.max_payment }}"
                                           class="form-control form-control--type2">
                                </div>

                            </div>
                        </div>
                    </div>

                    


                    <!-- 修改个人介绍 -->
                    <div class="row" style="display: flex;align-items: center; padding-top:60px; padding-bottom: 30px; ">
                        <div class="col-xs-4"><hr></div>
                        <div class="col-xs-4" style="text-align:center;"><h4>个人介绍修改</h4></div>
                        <div class="col-xs-4"><hr></div>
                    </div>

                    <textarea id="editor_id" name="introduction" style="width:100%;height:500px;">
                        {{ current_user.introduction}}
                    </textarea>

                    
                    <div class="row" style="">
                        <div class="col-md-6 col-md-offset-3 ct-u-paddingTop40">
                            <input id="submit" type="submit"
                                   class="btn btn-lg btn-wide btn-motive"
                                   value="确认修改">
                        </div>
                    </div>
                </form>


                <!-- 修改个人特质 -->
                <div class="row" style="display: flex;align-items: center; padding-top:60px; ">
                    <div class="col-xs-4"><hr></div>
                    <div class="col-xs-4" style="text-align:center;"><h4>服务项目修改</h4></div>
                    <div class="col-xs-4"><hr></div>
                </div>

                <br><br><br>
                {% block content %}

                {%  for topic in user_features%}

                <div class="panel panel-default">
                  <div class="panel-heading"><h3>{{topic.name}}</h3></div>
                  <div class="panel-body">
                    <ul class="ct-simpleList list-unstyled ct-u-marginBottom0" id="show{{topic.tag}}" style="width:80%;margin-left:10%;">
                        <div id="{{topic.id}}TXT">
                        {% for feature in topic.feature_list %}
                            <div class="row" style="padding-top:5px;padding-bottom: 5px; " id="{{ feature.f_id }}">
                                <div class="col-md-12">                           
                                    <p style="float: left;font-size:15px;"> <span class="label label-primary">{{ feature.m_name }}</span> {{ feature.f_name }} </p>
                                    <a href="" class="btn btn-danger" style="float: right; " onclick="delete_feature('{{ topic.id }}','{{ feature.f_name }}','{{ feature.m_id }}');return false">删除</a>
                                </div>
                            </div>
                        {% endfor %}
                        </div>
                    </ul>

                    <hr>
                    <form class="form-inline" name="{{topic.tag}}" id="{{topic.id}}" action="/complete-account-feature/"  onsubmit="showFeatures('{{topic.id}}');return false">
                    {% csrf_token %}
                    
                        <select class="form-control" id="minor_topic_id" name="minor_topic_id" required onchange="qingkong();">
                            <option value="">选择小话题</option>

                            {% for minor in topic.minor_topic_list %}
                            <option value="{{ minor.id }}">{{ minor.m_name }}</option>
                            {% endfor %}
                        </select>
                      <div class="form-group">
                        <input type="text" class="form-control" id="{{topic.tag}}" name="feature_name" placeholder="点此添加您要提供的服务">
                        <input type='hidden' name = 'topic_id' value="{{topic.id}}"}>
                        <input type='hidden' name = 'topic_tag' value="show{{topic.tag}}"}>
                      </div>                
                      <button type="submit" class="btn btn-info" style="">添加</button>
                    </form>

                  </div>
                </div>
                {% endfor %}

                {% endblock %}

            </div>
    	</div>
    </div>



{% endblock %}

{% block js %}
<!-- 富文本编辑器 -->
<script charset="utf-8" src="{% static 'frontEnd/plugins/kindeditor/kindeditor.js'%}"></script>
<script charset="utf-8" src="{% static 'frontEnd/plugins/kindeditor/lang/zh-CN.js'%}"></script>
<script>
        KindEditor.ready(function(K) {
                window.editor = K.create('#editor_id');
        });
</script>

<!-- 添加特质 -->
<script>
function showFeatures(tag){
    console.log('aa');
    console.log(tag);
    // $("#features").submit(function(){
        var data1 = $("#"+tag).serialize();
        console.log(data1);
        $.ajax({
            url : "/complete-account-feature/",
            type : "POST",
            dataType : "html",
            data : $("#"+tag).serialize(),
            success : function(str){
                console.log('成功');
                console.log(str);
                str2 = JSON.parse(str);
                console.log(str2);
                // $('#'+tag+"TXT").append("<li><i class=\"fa fa-check\"></i><span><a href=\"\"><i class=\"fa fa-trash\"></i></a>"+str2['data']['feature_name']+"</span></li>");
                $('#'+tag+"TXT").append("<div class=\"row\" style=\"padding-top:5px;padding-bottom: 5px; \"><div class=\"col-md-12\"><p style=\"float: left;font-size:15px;\"> <span class=\"label label-primary\">"+ str2['data']['m_name'] +"</span> "+ str2['data']['feature_name'] +" </p><a href=\"\" class=\"btn btn-danger\" style=\"float: right; \">删除</a></div></div>");
            }

        })
    // });
}
</script>

<!-- 删除特质 -->
<script>
    function delete_feature(id,z,t){
        console.log('aa');
        console.log(id);
        console.log(z);
        console.log(t);
        // var jsondata = {  
        //                 "topic_id" : id,
        //                 "feature_name" :  z,
        //                 "m_id" : t,
        //             };

        $.ajax({
            type : "POST",
            url : "/delete-feature/",
            // contentType: "application/json;charset=utf-8",
            dataType : "JSON",
            data : {"topic_id":id,"feature_name":z,"minor_topic_id":t},
            success : function(str){
                console.log('成功');
                console.log(str);
                console.log(str['data']['f_id']);
                var strID = str['data']['f_id'];
                $('#'+strID).html("");
            },
            error : function(err){
                console.log('失败');
                console.log(err);
            }

        })
    }
</script>

<!-- 切换小话题后，清空input -->
<script>
    function qingkong(){
        $("[name='feature_name']").val('');
    }
</script>
<!-- <script src="{% static 'frontEnd/js/shop.js' %}"></script> -->

<!-- 时间选择 -->
<!-- <script src="{% static 'frontEnd/plugins/datepicker/js/bootstrap-datepicker.min.js' %}"></script>
<script>jQuery('.input-daterange #birth').datepicker({});</script>

<script src="{% static 'frontEnd/plugins/bootstrap-slider/js/bootstrap-slider.js' %}"></script>
<script>jQuery('.sliderAmount').slider();</script>

<script src="{% static 'frontEnd/plugins/selectize.js-master/dist/js/standalone/selectize.min.js"></script> -->
{% endblock %}